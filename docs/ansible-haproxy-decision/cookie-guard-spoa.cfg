[cookie-guard]
spoe-agent cookie-guard
    option var-prefix cookieguard
    groups issue-token verify-token
    option pipelining
    timeout hello      2s
    timeout idle       30s
    timeout processing 2s
    use-backend cookie_guard_spoa_backend
    log global

spoe-message issue-token
    args src-ip=src ua="req.fhdr(User-Agent)"

spoe-message verify-token
    args src-ip=src ua="req.fhdr(User-Agent)" cookie=req.cook(hb_v2)

spoe-group issue-token
    messages issue-token

spoe-group verify-token
    messages verify-token

# Optional: route ALTCHA endpoints to the agent's HTTP listener (metrics port)
# Add matching rules in your frontend, e.g.:
#   acl altcha_routes path_beg -i /altcha /assets/altcha/
#   use_backend cookie_guard_http_backend if altcha_routes
# This backend serves the controller and verification endpoints.
